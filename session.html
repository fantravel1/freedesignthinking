<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Active Session - Free Design Thinking Hub</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- External CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            min-height: 100vh;
        }

        .session-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 6rem 2rem 4rem;
        }

        /* Progress Header */
        .session-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .menu-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid rgba(212, 175, 55, 0.3);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }

        .session-title {
            font-size: 2.5rem;
            color: #d4af37;
            font-family: 'Space Grotesk', sans-serif;
            margin-bottom: 0.5rem;
        }

        .session-subtitle {
            color: #c0c0c0;
            font-size: 1.1rem;
        }

        /* Progress Bar */
        .progress-section {
            margin: 2rem 0;
        }

        .progress-bar-container {
            background: rgba(42, 42, 62, 0.6);
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #d4af37, #aa8c2e);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            padding: 1rem;
            background: rgba(42, 42, 62, 0.4);
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .progress-step.completed {
            background: rgba(212, 175, 55, 0.2);
            border-color: rgba(212, 175, 55, 0.5);
        }

        .progress-step.active {
            background: rgba(212, 175, 55, 0.3);
            border-color: #d4af37;
            transform: scale(1.05);
        }

        .step-number {
            font-size: 0.9rem;
            color: #c0c0c0;
            margin-bottom: 0.25rem;
        }

        .step-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .step-name {
            font-size: 0.9rem;
            color: #e8e8e8;
            font-weight: 600;
        }

        /* Activity Card */
        .activity-card {
            background: rgba(26, 26, 46, 0.95);
            border-radius: 20px;
            padding: 3rem;
            margin: 3rem 0;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }

        .activity-header {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .activity-icon-large {
            font-size: 4rem;
        }

        .activity-info {
            flex: 1;
        }

        .activity-phase {
            color: #d4af37;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .activity-title {
            font-size: 2rem;
            color: #e8e8e8;
            font-family: 'Space Grotesk', sans-serif;
            margin-bottom: 0.5rem;
        }

        .activity-duration {
            color: #c0c0c0;
            font-size: 1rem;
        }

        .activity-description {
            color: #c0c0c0;
            line-height: 1.8;
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 15px;
            margin: 2rem 0;
            background: rgba(0, 0, 0, 0.3);
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .watch-video-btn {
            display: inline-block;
            background: linear-gradient(135deg, #d4af37, #aa8c2e);
            color: #1a1a2e;
            padding: 1rem 2rem;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .watch-video-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        /* Timer Section */
        .timer-section {
            background: rgba(42, 42, 62, 0.6);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin: 2rem 0;
        }

        .timer-label {
            color: #c0c0c0;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .timer-display {
            font-size: 3rem;
            font-family: 'Space Grotesk', monospace;
            color: #d4af37;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .timer-btn {
            background: rgba(212, 175, 55, 0.2);
            border: 2px solid #d4af37;
            color: #d4af37;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .timer-btn:hover {
            background: #d4af37;
            color: #1a1a2e;
        }

        .timer-btn.active {
            background: #d4af37;
            color: #1a1a2e;
        }

        /* Navigation Buttons */
        .session-nav {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 3rem;
        }

        .nav-btn {
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn-secondary {
            background: rgba(42, 42, 62, 0.8);
            color: #c0c0c0;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }

        .nav-btn-secondary:hover {
            background: rgba(42, 42, 62, 1);
            border-color: #d4af37;
            color: #d4af37;
        }

        .nav-btn-primary {
            background: linear-gradient(135deg, #d4af37, #aa8c2e);
            color: #1a1a2e;
            flex: 1;
            justify-content: center;
        }

        .nav-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Completion Screen */
        .completion-screen {
            display: none;
            text-align: center;
            padding: 4rem 2rem;
        }

        .completion-screen.active {
            display: block;
        }

        .completion-icon {
            font-size: 6rem;
            margin-bottom: 2rem;
            animation: bounce 1s ease;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }

        .completion-title {
            font-size: 3rem;
            color: #d4af37;
            font-family: 'Space Grotesk', sans-serif;
            margin-bottom: 1rem;
        }

        .completion-message {
            font-size: 1.3rem;
            color: #c0c0c0;
            margin-bottom: 3rem;
            line-height: 1.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: rgba(42, 42, 62, 0.6);
            padding: 2rem;
            border-radius: 15px;
            border: 2px solid rgba(212, 175, 55, 0.2);
        }

        .stat-number {
            font-size: 2.5rem;
            color: #d4af37;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #c0c0c0;
            font-size: 0.9rem;
        }

        .completion-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .session-container {
                padding: 5rem 1rem 2rem;
            }

            .session-title {
                font-size: 2rem;
            }

            .progress-steps {
                flex-direction: column;
                gap: 0.75rem;
            }

            .progress-step {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1rem;
            }

            .progress-step .step-icon {
                font-size: 1.5rem;
            }

            .activity-card {
                padding: 2rem 1.5rem;
            }

            .activity-header {
                flex-direction: column;
            }

            .activity-title {
                font-size: 1.5rem;
            }

            .timer-display {
                font-size: 2rem;
            }

            .session-nav {
                flex-direction: column;
            }

            .completion-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        /* No Session State */
        .no-session {
            text-align: center;
            padding: 4rem 2rem;
        }

        .no-session-icon {
            font-size: 5rem;
            margin-bottom: 2rem;
            opacity: 0.5;
        }

        .no-session-title {
            font-size: 2rem;
            color: #c0c0c0;
            margin-bottom: 1rem;
        }

        .no-session-message {
            color: #999;
            margin-bottom: 2rem;
        }
    </style>
</head>

<body>
    <header>
        <nav class="container">
            <a href="index.html" class="logo">üé® Free Design Thinking Hub</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="design-menus.html">Design Menus</a></li>
                <li><a href="bookmarks.html">My Bookmarks</a></li>
            </ul>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle menu">
                <span id="menu-icon">‚ò∞</span>
            </button>
        </nav>
        <div class="mobile-nav" id="mobile-nav">
            <ul>
                <li><a href="index.html" onclick="closeMobileMenu()">Home</a></li>
                <li><a href="design-menus.html" onclick="closeMobileMenu()">Design Menus</a></li>
                <li><a href="bookmarks.html" onclick="closeMobileMenu()">My Bookmarks</a></li>
            </ul>
        </div>
    </header>

    <div class="session-container">
        <!-- No Session State -->
        <div id="noSessionState" class="no-session">
            <div class="no-session-icon">üéØ</div>
            <h1 class="no-session-title">No Active Session</h1>
            <p class="no-session-message">Start a Design Menu to begin your design thinking journey!</p>
            <a href="design-menus.html" class="watch-video-btn">Browse Design Menus</a>
        </div>

        <!-- Active Session State -->
        <div id="activeSessionState" style="display: none;">
            <!-- Header -->
            <div class="session-header">
                <div class="menu-badge">
                    <span id="menuIcon">üå±</span>
                    <span id="menuName">Loading...</span>
                </div>
                <h1 class="session-title" id="sessionTitle">Your Design Thinking Session</h1>
                <p class="session-subtitle" id="sessionSubtitle">Follow the pathway to complete your project</p>
            </div>

            <!-- Progress Bar -->
            <div class="progress-section">
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="progress-steps" id="progressSteps">
                    <!-- Steps will be inserted here -->
                </div>
            </div>

            <!-- Current Activity -->
            <div class="activity-card" id="activityCard">
                <!-- Activity content will be inserted here -->
            </div>

            <!-- Navigation -->
            <div class="session-nav">
                <button class="nav-btn nav-btn-secondary" id="prevBtn" onclick="previousStep()">
                    ‚Üê Previous Step
                </button>
                <button class="nav-btn nav-btn-secondary" id="pauseBtn" onclick="pauseSession()">
                    ‚è∏ Pause & Save
                </button>
                <button class="nav-btn nav-btn-primary" id="nextBtn" onclick="nextStep()">
                    Complete & Continue ‚Üí
                </button>
            </div>
        </div>

        <!-- Completion Screen -->
        <div id="completionScreen" class="completion-screen">
            <div class="completion-icon">üéâ</div>
            <h1 class="completion-title">Congratulations!</h1>
            <p class="completion-message">
                You've completed the <strong id="completedMenuName">Design Menu</strong>!<br>
                You've taken a significant step in your design thinking journey.
            </p>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalTime">--</div>
                    <div class="stat-label">Minutes Spent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">5</div>
                    <div class="stat-label">Steps Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedCount">--</div>
                    <div class="stat-label">Total Sessions</div>
                </div>
            </div>

            <div class="completion-actions">
                <a href="design-menus.html" class="watch-video-btn">Start Another Menu</a>
                <a href="index.html" class="nav-btn nav-btn-secondary">Back to Home</a>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 Free Design Thinking Hub. All rights reserved. Built with ‚ù§Ô∏è for global accessibility.</p>
        </div>
    </footer>

    <!-- Include dependencies -->
    <script src="js/videoDatabase.js"></script>
    <script src="js/designMenus.js"></script>
    <script src="js/sessionManager.js"></script>

    <script>
        console.log('üéØ Session page loaded');

        // Phase configuration
        const phaseConfig = {
            'warmUp': { icon: 'üèÉ', color: '#ff6b6b', name: 'Warm-Up', phase: 'warm-up' },
            'brainstorm': { icon: 'üß†', color: '#667eea', name: 'Brainstorm', phase: 'brainstorm' },
            'prototype': { icon: 'üîß', color: '#4ecdc4', name: 'Prototype', phase: 'prototype' },
            'test': { icon: 'üß™', color: '#a8e6cf', name: 'Test', phase: 'test' },
            'reflect': { icon: 'ü§î', color: '#8360c3', name: 'Reflect', phase: 'reflect' }
        };

        const phaseOrder = ['warmUp', 'brainstorm', 'prototype', 'test', 'reflect'];

        let timerInterval = null;
        let timerSeconds = 0;
        let timerRunning = false;

        // Initialize page
        function initSession() {
            const session = sessionManager.getCurrentSession();

            if (!session) {
                document.getElementById('noSessionState').style.display = 'block';
                document.getElementById('activeSessionState').style.display = 'none';
                return;
            }

            document.getElementById('noSessionState').style.display = 'none';
            document.getElementById('activeSessionState').style.display = 'block';

            renderSession(session);
        }

        // Render session UI
        function renderSession(session) {
            // Update header
            document.getElementById('menuIcon').textContent = session.menuIcon;
            document.getElementById('menuName').textContent = session.menuName;

            // Update progress bar
            const progress = (session.completedSteps.length / 5) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            // Render progress steps
            renderProgressSteps(session);

            // Render current activity
            renderCurrentActivity(session);
        }

        // Render progress steps
        function renderProgressSteps(session) {
            const stepsContainer = document.getElementById('progressSteps');
            stepsContainer.innerHTML = phaseOrder.map((phase, index) => {
                const config = phaseConfig[phase];
                const isCompleted = session.completedSteps.includes(index);
                const isActive = session.currentStep === index;

                return `
                    <div class="progress-step ${isCompleted ? 'completed' : ''} ${isActive ? 'active' : ''}"
                         onclick="goToStep(${index})">
                        <div class="step-number">Step ${index + 1}/5</div>
                        <div class="step-icon">${config.icon}</div>
                        <div class="step-name">${config.name}</div>
                    </div>
                `;
            }).join('');
        }

        // Render current activity
        function renderCurrentActivity(session) {
            const currentStepIndex = session.currentStep;
            const phaseName = phaseOrder[currentStepIndex];
            const config = phaseConfig[phaseName];
            const videoId = session.activities[phaseName];

            // Get video details
            const phaseVideos = videoDatabase[config.phase] || [];
            const video = phaseVideos.find(v => v.id === videoId) || {
                title: 'Video not found',
                description: 'This video is not available',
                url: '#',
                duration: 'TBD'
            };

            const activityCard = document.getElementById('activityCard');
            const embedUrl = video.url.includes('youtube.com') || video.url.includes('youtu.be')
                ? video.url.replace('watch?v=', 'embed/').replace('youtu.be/', 'youtube.com/embed/')
                : video.url;

            activityCard.innerHTML = `
                <div class="activity-header">
                    <div class="activity-icon-large" style="color: ${config.color}">${config.icon}</div>
                    <div class="activity-info">
                        <div class="activity-phase" style="color: ${config.color}">${config.name}</div>
                        <h2 class="activity-title">${video.title}</h2>
                        <div class="activity-duration">‚è± ${video.duration || 'TBD'}</div>
                    </div>
                </div>
                <p class="activity-description">${video.description}</p>

                ${video.url !== '#' ? `
                    <div class="video-container">
                        <iframe src="${embedUrl}" allowfullscreen></iframe>
                    </div>
                ` : '<p style="color: #c0c0c0;">Video coming soon</p>'}

                <div class="timer-section">
                    <div class="timer-label">Activity Timer</div>
                    <div class="timer-display" id="timerDisplay">00:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn" onclick="startTimer()">‚ñ∂ Start</button>
                        <button class="timer-btn" onclick="pauseTimer()">‚è∏ Pause</button>
                        <button class="timer-btn" onclick="resetTimer()">‚èπ Reset</button>
                    </div>
                </div>

                <a href="${video.url}" target="_blank" class="watch-video-btn" style="margin-top: 1rem;">
                    ‚ñ∂ Open Video in New Tab
                </a>
            `;

            // Update navigation buttons
            updateNavigationButtons(session);
        }

        // Update navigation buttons
        function updateNavigationButtons(session) {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            prevBtn.disabled = session.currentStep === 0;

            if (session.currentStep === 4) {
                nextBtn.textContent = 'üéâ Complete Session';
            } else {
                nextBtn.textContent = 'Complete & Continue ‚Üí';
            }
        }

        // Navigate to specific step
        function goToStep(stepIndex) {
            sessionManager.goToStep(stepIndex);
            initSession();
        }

        // Previous step
        function previousStep() {
            const session = sessionManager.getCurrentSession();
            if (session.currentStep > 0) {
                sessionManager.goToStep(session.currentStep - 1);
                initSession();
            }
        }

        // Next step
        function nextStep() {
            const session = sessionManager.getCurrentSession();

            // Mark current step as complete
            sessionManager.completeStep(session.currentStep);

            // Check if this was the last step
            if (session.currentStep >= 4) {
                completeSession();
            } else {
                initSession();
            }
        }

        // Pause session
        function pauseSession() {
            if (confirm('Pause your session? Your progress will be saved and you can resume anytime.')) {
                window.location.href = 'design-menus.html';
            }
        }

        // Complete session
        function completeSession() {
            const completedSession = sessionManager.completeSession();

            // Show completion screen
            document.getElementById('activeSessionState').style.display = 'none';
            document.getElementById('completionScreen').classList.add('active');

            // Update completion stats
            document.getElementById('completedMenuName').textContent = completedSession.menuName;
            document.getElementById('totalTime').textContent = completedSession.totalTime || 0;
            document.getElementById('completedCount').textContent = sessionManager.getHistory().length;

            // Confetti effect (optional - could add library)
            console.log('üéâ Session completed!', completedSession);
        }

        // Timer functions
        function startTimer() {
            if (!timerRunning) {
                timerRunning = true;
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    updateTimerDisplay();
                }, 1000);
            }
        }

        function pauseTimer() {
            timerRunning = false;
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        }

        function resetTimer() {
            pauseTimer();
            timerSeconds = 0;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            const display = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            const mobileNav = document.getElementById('mobile-nav');
            const menuBtn = document.querySelector('.mobile-menu-btn');
            const isOpen = mobileNav.classList.contains('active');

            if (isOpen) {
                mobileNav.classList.remove('active');
                menuBtn.setAttribute('aria-expanded', 'false');
                document.getElementById('menu-icon').textContent = '‚ò∞';
            } else {
                mobileNav.classList.add('active');
                menuBtn.setAttribute('aria-expanded', 'true');
                document.getElementById('menu-icon').textContent = '‚úï';
            }
        }

        function closeMobileMenu() {
            const mobileNav = document.getElementById('mobile-nav');
            const menuBtn = document.querySelector('.mobile-menu-btn');
            mobileNav.classList.remove('active');
            menuBtn.setAttribute('aria-expanded', 'false');
            document.getElementById('menu-icon').textContent = '‚ò∞';
        }

        // Initialize on page load
        initSession();
    </script>
</body>
</html>
